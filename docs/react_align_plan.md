React→Compose UX Alignment (single source)
==========================================

Goal: Match the React/JSX UI **and UX** flows in the Compose app. React is the UX/UI spec; Kotlin/Compose remains the logic source of truth.

Source: Generated by tools/update_react_align_plan.py; edit docs/react_align_plan_data.json then rerun the script.

Scope & principles
- Keep data/domain logic; adapt UI routing, states, and visuals to mirror React.
- Preserve test tags; update tests to assert React flows (no weakening).
- Use DesignKit tokens/components as the React UI-kit equivalents (gradients/glass cards/badges/buttons).

Route/component matrix (parity checkpoints)
- **Home overlays**: Default landing = Home. Vertical stack (Home center, Device up, Audio down). Back → Home. Entry cards: Device → DeviceManager when connected else DeviceSetup; Audio → AudioFiles; Profile → UserCenter; History toggle matches React。Home hero = LOGO、问候语、两行 bullet +技能 pills。
- **DeviceManager**: Entry via Home card/overlay. States: disconnected banner, loading, empty, list, errors. Actions: refresh/upload/apply/delete as per React copy。视觉：深色预览卡“选择文件预览” + upload tile 卡，空态“暂无文件，请上传。”，顶部刷新按钮。
- **DeviceSetup**: From Home when not connected. Steps, hints, CTA labels mirror React.
- **AudioFiles**: From Home card. Empty/loading/error/recording list, transcript sheet, actions match React。列表支持已同步/未同步/转写中/错误标记，右侧状态标签或文字；顶部刷新；转写完成页含播放器+时间轴+Markdown 文本+底部“用 AI 分析本次通话”大按钮。
- **ChatHistory**: Drawer/route behavior mirrors React; empty/loading, rename/delete/pin flows consistent。
- **UserCenter**: Entry via profile; form, flags, save/logout states match React copy。淡紫背景，头像圆卡 + 邮箱，卡片式入口：设备管理/订阅管理/隐私与安全/通用设置。

Visual alignment
- Use DesignKit for consistent visuals (gradients, glass cards, badges, buttons) mirroring the React UI kit.
- Match empty/loading/error text to React; keep test tags stable.
- 参考 `UI/` 及 `real-interface/*.jpg`：浅灰背景、圆角白卡、顶部 AppBar icons、底部大按钮渐变（Transcript CTA）、设备预览深色卡、UserCenter icon-leading 卡片。

Navigation contract
- HomeScreenViewModel emits `HomeNavigationRequest` (DeviceManager/Setup/AudioFiles/UserCenter/History) based on state.
- AiFeatureTestActivity consumes requests, switches overlays/pages accordingly; back returns to Home overlay/section.

Roadmap & milestones
- M1 Shell 导航对齐（完成）  
  - Home 竖向叠层切换（音频/主页/设备），返回栈统一回到 Home。  
  - `HomeNavigationRequest` → AiFeatureTestActivity 路由落地，测试覆盖入口/返回。
- M2 文案与状态对齐（完成）  
  - DeviceSetup/DeviceManager/AudioFiles/ChatHistory/UserCenter 的空/错/加载/CTA 文案与 React 一致。  
  - 对应 UI/仪表测试更新、保持 testTag 稳定。
- M3 视觉与交互细节（完成）  
  - DesignKit 色板、渐变、徽章、按钮；Home 叠层拖拽/按压动画；DeviceManager 应用状态提示。  
  - Applied 徽标与“当前展示”文案、AudioFiles CTA 与 Transcript 抽屉文案同步 React。
- M4 集成性改进（待办）  
  - 自动同步 Wi-Fi/BLE baseUrl 至 DeviceManager/AudioFiles；转写结果回写聊天历史。  
  - React 新 UI 变更日常回归，确保新差异可追踪。
- M5 稳定性与验证（进行中）  
  - 导航/叠层/页面仪表测试抗 flake，`connectedDebugAndroidTest`、lint 常绿；依赖/权限健康检查。

Workstreams（技术视角）
- React 差异审计：监控 React/JSX 变更，记录新增 UI/文案/动效差异并排期合入（持续）。
- Shell 叠层交互：保持拖拽/弹簧参数、手柄、遮罩与测试 tag；必要时调整物理参数以贴合 React。
- 视觉与文案一致性：按页面核对 DesignKit 色板、渐变、徽章、CTA 文案；避免平台差异导致的对齐偏差。
- 跨页面集成：baseUrl 自动同步（Wi-Fi/BLE → DeviceManager/AudioFiles）、转写结果回写聊天历史，确保逻辑与 React 一致。
- 稳定性与测试：导航/叠层/页面仪表测试维护，flake 监控；lint/依赖健康度检查。
- 变更防护：新增差异需更新 `react_align_plan.md`，并以小步提交 + 仪表验证锁定行为。

Execution steps
- 对齐参考：完整走读 `UI/Pages/*.jsx` + `UI/Components` 与 `real-interface/*.jpg`，梳理每屏布局、间距、圆角、色板、复制文案。
- 设计 token：落地浅灰背景、卡片圆角/阴影、渐变 CTA、手柄宽高与 icon 尺寸，集中在 Compose 端的 DesignKit（可放 `core/util/ui` 或各 feature 内复用）。
- Shell 叠层：让 AiFeatureTestActivity 的竖向 overlay 与 React 一致（窄 rail、轻背景、统一 handle），返回行为始终回到 Home；保持 testTag 覆盖。
- 分屏迁移：Home（Hero LOGO/问候/要点对齐）、DeviceManager（浅色 Hero + 空/错/加载文案）、AudioFiles（转写抽屉、播放器描边与渐变 CTA）、UserCenter（淡紫背景+卡片栈）、DeviceSetup/ChatHistory（流程与文案对齐）。
- 仪表测试：每屏调整后同步更新对应 androidTest，验证 overlay 路由、入口点击与 CTA 文案，保持 tag 不变。
- 验证：跑 `./gradlew testDebugUnitTest` 以及关键 UI 测试（connectedDebugAndroidTest 视环境）；发现新的 React 差异及时更新 `docs/react_align_progress.md` / plan 数据。

Progress tracking
- 进度详情移至 `docs/react_align_progress.md`（含日期与对应改动），本文件仅保留对齐要求。

Risks & mitigations
- Instrumentation flake: wait on tags/state, avoid sleeps.
- Behavior drift: follow React reference and `api-contracts.md`; avoid logic/API changes without approval.
- Performance: keep motion/light effects modest to avoid overdraw.
