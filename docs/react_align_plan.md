React→Compose UX Alignment (single source)
==========================================

Goal: Match the React/JSX UI **and UX** flows in the Compose app. React is the UX/UI spec; Kotlin/Compose remains the logic source of truth.

Source: Generated by tools/update_react_align_plan.py; edit docs/react_align_plan_data.json then rerun the script.

Scope & principles
- Keep data/domain logic; adapt UI routing, states, and visuals to mirror React.
- Preserve test tags; update tests to assert React flows (no weakening).
- Use DesignKit tokens/components as the React UI-kit equivalents (gradients/glass cards/badges/buttons).

Route/component matrix (parity checkpoints)
- **Home overlays**: Default landing = Home. Vertical stack (Home center, Device up, Audio down). Back → Home. Entry cards: Device → DeviceManager when connected else DeviceSetup; Audio → AudioFiles; Profile → UserCenter; History toggle matches React.
- **DeviceManager**: Entry via Home card/overlay. States: disconnected banner, loading, empty, list, errors. Actions: refresh/upload/apply/delete as per React copy.
- **DeviceSetup**: From Home when not connected. Steps, hints, CTA labels mirror React.
- **AudioFiles**: From Home card. Empty/loading/error/recording list, transcript sheet, actions match React.
- **ChatHistory**: Drawer/route behavior mirrors React; empty/loading, rename/delete/pin flows consistent.
- **UserCenter**: Entry via profile; form, flags, save/logout states match React copy.

Visual alignment
- Use DesignKit for consistent visuals (gradients, glass cards, badges, buttons) mirroring the React UI kit.
- Match empty/loading/error text to React; keep test tags stable.

Navigation contract
- HomeScreenViewModel emits `HomeNavigationRequest` (DeviceManager/Setup/AudioFiles/UserCenter/History) based on state.
- AiFeatureTestActivity consumes requests, switches overlays/pages accordingly; back returns to Home overlay/section.

Execution steps
- Shell: make AiFeatureTestActivity honor Home navigation requests with the React vertical overlays (Home center, Device up → manager/setup by connection, Audio down), always backing to Home.
- Home UI: mirror React welcome/skill-first chat (Markdown/复制 affordance, chip lifecycle) while keeping session handling and test tags.
- Screen states: copy React empty/loading/error/CTA text and actions for DeviceManager, DeviceSetup, AudioFiles (transcript drawer “用 AI 分析本次通话”), ChatHistory (long-press rename/pin/delete), and UserCenter menus.
- Tests: refresh instrumentation to assert the React journeys (overlay routing, device/audio/profile/history taps) without weakening assertions; keep unmerged trees for overlays and reasonable timeouts.

Progress (2025-11-27)
- Shell/navigation aligned: AiFeatureTestActivity consumes Home navigation requests and routes device overlay to setup when offline and manager when connected; back always returns Home.
- Tests updated: DeviceManager chip now expects DeviceSetup when offline and DeviceManager after provisioning.
- Home chat: assistant气泡支持「复制」操作，空态改为销售助手欢迎文案；会话长按底部抽屉可置顶/重命名/删除。
- DeviceManager 屏新增标题与说明，贴近 React “设备管理” 头部。 
- DeviceSetup 文案与 CTA 对齐 React：扫描/配对/等待/完成提示调整，完成后按钮为“前往设备管理”。
- AudioFiles 文案对齐：顶部说明文案、空态提示、错误收起按钮、转写抽屉 CTA 更贴近 React。
- UserCenter 顶部补充账号说明文案，贴近 React 配置页介绍。
- Instrumentation refreshed：AiFeatureTestActivityTest 覆盖 UserCenter 说明文案，ChatHistoryScreenTest 验证长按抽屉置顶操作，NavigationSmokeTest 断言 AudioFiles/ UserCenter 文案，并复位设备状态防止 flake。
- DeviceManager 仪表测试稳定：文件卡/选中卡补充 testTag，列表滚动基于 testTag 规避同名文本导致的多节点冲突。
- React UI audit完成：Home 垂直拖拽 overlay、Sidebar 历史分组/重命名/置顶、设备状态卡、DeviceSetup → DeviceManager 自动跳转、AudioFiles/Transcript CTA、UserCenter 菜单项等差异已记录，准备下一轮实现。
- Next up: apply overlay/overlay-return 逻辑与 Device 状态文案调整，移除对 Home chip 的依赖，更新导航测试等待 Home root/page。

Risks & mitigations
- Instrumentation flake: wait on tags/state, avoid sleeps.
- Behavior drift: follow React reference and `api-contracts.md`; avoid logic/API changes without approval.
- Performance: keep motion/light effects modest to avoid overdraw.
